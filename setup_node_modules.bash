#!/bin/bash

# colors
GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m'

echo -e "${GREEN}Starting Tailwind CSS + DaisyUI installation...${NC}"

# check for nvm
if ! command -v nvm &> /dev/null; then
    echo -e "${RED}NVM not found. Installing NVM...${NC}"
    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.3/install.sh | bash
    export NVM_DIR="$HOME/.nvm"
    [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
    [ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"
else
    export NVM_DIR="$HOME/.nvm"
    [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
    [ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"
fi

# install last node js version
echo -e "${GREEN}Installing Node.js LTS version...${NC}"
nvm install --lts
nvm use --lts
nvm alias default lts/*

# init with npm
if [ ! -f "package.json" ]; then
    echo -e "${GREEN}Initializing npm project...${NC}"
    npm init -y
fi

# install tailwind css
echo -e "${GREEN}Installing Tailwind CSS and dependencies...${NC}"
npm install -D tailwindcss@3.4.1 postcss@^8.4.0 autoprefixer@^10.4.0
npm install daisyui@^4.0.0
npm install archiver

# install live-server
echo -e "${GREEN}Installing live-server...${NC}"
npm install -D live-server

echo -e "${GREEN}Installing bcrypt ...${NC}"
npm install -D express express-session bcrypt
npm install -D dotenv
npm install jsonwebtoken
# config files
echo -e "${GREEN}Creating configuration files...${NC}"

# create tailwind.config.js
cat > tailwind.config.js << 'EOL'
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    "./*.html",
    "./*.js",
    "./script.js"
  ],
  theme: { extend: {} },
  plugins: [require("daisyui")]
};
EOL

# create postcss.config.js
cat > postcss.config.js << 'EOL'
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
EOL

# create input.css only if it does not exist
if [ ! -f "input.css" ]; then
cat > input.css << 'EOL'
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
    --color-body-gradient-from: white;
    --color-body-gradient-via: #FEF2F2;
    --color-body-gradient-to: #FFF7ED;

    --color-accent-gradient-from: #71f6f8;
    --color-accent-gradient-to: #493cfb;

    --color-text-heading: #DC2626;
}
EOL


# add build script
npm pkg set scripts.build="npx tailwindcss -i ./input.css -o ./output.css --watch"

# first compile 
echo -e "${GREEN}Compiling Tailwind CSS...${NC}"
./node_modules/.bin/tailwindcss -i ./input.css -o ./output.css

echo -e "${GREEN}Setup complete! To start development:${NC}"
echo -e "Run ${GREEN}npm run build${NC} to build "
echo -e "Open ${GREEN}index.html${NC} in your browser or use ${GREEN}npx live-server --port=8080${NC}"
